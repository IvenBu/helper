:- module(hashtrie, [empty_trie/1, insert/4, count/2, list_to_trie/2, lookup/3]).

:- use_module(library(plunit)).
:- use_module(library(lists)).
:- use_module(library(terms)).

%nil(_).
empty_trie(X) :-
    empty_node(X).

empty_node(n(nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil)).
%empty_node(n(X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X,X)) :-
%   nil(X).
is_node(n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31)).

% UNifiziert zwei Knoten mit ausname der Angegebenen Position.
unify_except_pos(0,  n(_A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(_,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(1,  n(A0,_A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,_,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(2,  n(A0,A1,_A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,_,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(3,  n(A0,A1,A2,_A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,_,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(4,  n(A0,A1,A2,A3,_A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,_,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(5,  n(A0,A1,A2,A3,A4,_A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,_,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(6,  n(A0,A1,A2,A3,A4,A5,_A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,_,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(7,  n(A0,A1,A2,A3,A4,A5,A6,_A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,_,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(8,  n(A0,A1,A2,A3,A4,A5,A6,A7,_A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,_,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(9,  n(A0,A1,A2,A3,A4,A5,A6,A7,A8,_A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,_,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(10, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,_A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,_,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(11, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,_A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,_,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(12, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,_A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,_,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(13, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,_A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,_,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(14, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,_A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,_,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(15, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,_A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,_,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(16, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,_A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,_,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(17, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,_A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,_,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(18, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,_A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,_,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(19, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,_A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,_,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(20, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,_A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,_,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(21, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,_A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,_,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(22, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,_A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,_,A23,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(23, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,_A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,_,A24,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(24, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,_A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,_,A25,A26,A27,A28,A29,A30,A31)).
unify_except_pos(25, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,_A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,_,A26,A27,A28,A29,A30,A31)).
unify_except_pos(26, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,_A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,_,A27,A28,A29,A30,A31)).
unify_except_pos(27, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,_A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,_,A28,A29,A30,A31)).
unify_except_pos(28, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,_A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,_,A29,A30,A31)).
unify_except_pos(29, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,_A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,_,A30,A31)).
unify_except_pos(30, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,_A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,_,A31)).
unify_except_pos(31, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,_A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,_)).


%Unifiziert zwei Knoten mit Ausnahme einer angegebenen Position. Der Wert dieser Positon des Zweiten Knotens wird anschließend ausgegeben.
unify_except_pos_and_get(0,  n(_A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(X,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(1,  n(A0,_A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,X,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(2,  n(A0,A1,_A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,X,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(3,  n(A0,A1,A2,_A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,X,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(4,  n(A0,A1,A2,A3,_A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,X,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(5,  n(A0,A1,A2,A3,A4,_A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,X,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(6,  n(A0,A1,A2,A3,A4,A5,_A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,X,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(7,  n(A0,A1,A2,A3,A4,A5,A6,_A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,X,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(8,  n(A0,A1,A2,A3,A4,A5,A6,A7,_A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,X,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(9,  n(A0,A1,A2,A3,A4,A5,A6,A7,A8,_A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,X,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(10, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,_A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,X,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(11, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,_A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,X,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(12, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,_A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,X,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(13, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,_A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,X,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(14, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,_A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,X,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(15, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,_A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,X,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(16, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,_A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,X,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(17, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,_A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,X,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(18, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,_A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,X,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(19, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,_A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,X,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(20, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,_A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,X,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(21, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,_A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,X,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(22, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,_A22,A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,X,A23,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(23, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,_A23,A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,X,A24,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(24, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,_A24,A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,X,A25,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(25, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,_A25,A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,X,A26,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(26, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,_A26,A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,X,A27,A28,A29,A30,A31), X).
unify_except_pos_and_get(27, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,_A27,A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,X,A28,A29,A30,A31), X).
unify_except_pos_and_get(28, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,_A28,A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,X,A29,A30,A31), X).
unify_except_pos_and_get(29, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,_A29,A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,X,A30,A31), X).
unify_except_pos_and_get(30, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,_A30,A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,X,A31), X).
unify_except_pos_and_get(31, n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,_A31), n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,X), X).


% Gibt den Wert an Position N aus einem Knoten aus.
get_pos(0, n(A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A0).
get_pos(1, n(_A0,A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A1).
get_pos(2, n(_A0,_A1,A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A2).
get_pos(3, n(_A0,_A1,_A2,A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A3).
get_pos(4, n(_A0,_A1,_A2,_A3,A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A4).
get_pos(5, n(_A0,_A1,_A2,_A3,_A4,A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A5).
get_pos(6, n(_A0,_A1,_A2,_A3,_A4,_A5,A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A6).
get_pos(7, n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A7).
get_pos(8, n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A8).
get_pos(9, n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A9).
get_pos(10,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A10).
get_pos(11,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A11).
get_pos(12,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A12).
get_pos(13,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A13).
get_pos(14,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A14).
get_pos(15,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A15).
get_pos(16,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A16).
get_pos(17,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A17).
get_pos(18,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A18).
get_pos(19,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A19).
get_pos(20,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A20).
get_pos(21,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A21).
get_pos(22,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A22).
get_pos(23,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A23).
get_pos(24,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,A24,_A25,_A26,_A27,_A28,_A29,_A30,_A31),A24).
get_pos(25,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,A25,_A26,_A27,_A28,_A29,_A30,_A31),A25).
get_pos(26,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,A26,_A27,_A28,_A29,_A30,_A31),A26).
get_pos(27,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,A27,_A28,_A29,_A30,_A31),A27).
get_pos(28,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,A28,_A29,_A30,_A31),A28).
get_pos(29,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,A29,_A30,_A31),A29).
get_pos(30,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,A30,_A31),A30).
get_pos(31,n(_A0,_A1,_A2,_A3,_A4,_A5,_A6,_A7,_A8,_A9,_A10,_A11,_A12,_A13,_A14,_A15,_A16,_A17,_A18,_A19,_A20,_A21,_A22,_A23,_A24,_A25,_A26,_A27,_A28,_A29,_A30,A31),A31).


% mit term_Hash hole ich mir nen Hash wert für den first-Index zugriff
insert(Trie, Key, Value, NewTrie) :-
    term_hash(Key, Hash),
    insert_with_hash(0, Hash, Key, Value, Trie, NewTrie).
insert_with_hash(Level, Hash, Key, Value, Trie, NewTrie) :-
    calc_pos(Hash, Level, Pos),
    get_pos(Pos, Trie, ValAtPos),
    unify_except_pos_and_get(Pos, Trie, NewTrie, RTree),
    insert_with_val_at_pos(ValAtPos, Level, Hash, Key, Value, RTree).
insert_with_val_at_pos(v(Key, _), _Level, _Hash, Key, Value, v(Key, Value)) :- !.
insert_with_val_at_pos(v(Key1, Value1), Level, Hash2, Key2, Value2, NewTrie) :- !,
    % Key1 \= Key2,
    term_hash(Key1, Hash1),
    (Hash1 = Hash2
      -> NewTrie = collision([v(Key1, Value1), v(Key2, Value2)])
       ; (empty_node(FreshTrie),
          Level1 is Level + 1,
          insert_with_hash(Level1, Hash1, Key1, Value1, FreshTrie, TTrie),
          insert_with_hash(Level1, Hash2, Key2, Value2, TTrie, NewTrie))).
insert_with_val_at_pos(nil, _Level, _Hash, Key, Value, v(Key, Value)) :- !.
insert_with_val_at_pos(collision(Collisions), Level, Hash, Key, Value, Res) :- !,
    Collisions = [v(K1, _)|_],
    term_hash(K1, Hash1),
    (Hash1 == Hash
     -> Res = collision([v(Key, Value)|Collisions])
      ; (empty_node(FreshTrie),
         Level1 is Level + 1,
         calc_pos(Hash1, Level1, Pos),
         unify_except_pos_and_get(Pos, FreshTrie, Tmp, collision(Collisions)),
         %get_pos(Pos, Tmp, collision(Collisions)),
         insert_with_hash(Level1, Hash, Key, Value, Tmp, Res))).
insert_with_val_at_pos(Node, Level, Hash, Key, Value, NewTrie) :-
    % is_node(Node),
    Level1 is Level + 1,
    insert_with_hash(Level1, Hash, Key, Value, Node, NewTrie).


calc_pos(Hash, Level, Pos) :-
    Shifted is (Hash >> (Level * 5)),
    Pos is (Shifted /\ 31).


%% TODO: let cuts in their or nah
count(Trie, N) :-
    Trie = n(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31),
    !,
    count(A0, N0),
	count(A1, N1),
	count(A2, N2),
	count(A3, N3),
	count(A4, N4),
	count(A5, N5),
	count(A6, N6),
	count(A7, N7),
	count(A8, N8),
	count(A9, N9),
	count(A10, N10),
	count(A11, N11),
	count(A12, N12),
	count(A13, N13),
	count(A14, N14),
	count(A15, N15),
	count(A16, N16),
	count(A17, N17),
	count(A18, N18),
	count(A19, N19),
	count(A20, N20),
	count(A21, N21),
	count(A22, N22),
	count(A23, N23),
	count(A24, N24),
	count(A25, N25),
	count(A26, N26),
	count(A27, N27),
	count(A28, N28),
	count(A29, N29),
	count(A30, N30),
	count(A31, N31),
 	N is N0 + N1 + N2 + N3 + N4 + N5 + N6 + N7 + N8 + N9 + N10 + N11 + N12 + N13 + N14 + N15 + N16 + N17 + N18 + N19 + N20 + N21 + N22 + N23 + N24 + N25 + N26 + N27 + N28 + N29 + N30 + N31.
count(nil, 0) :- !.
count(v(_, _), 1) :- !.
count(collision(L), X) :- !,
    length(L, X).



list_to_trie(L, Trie) :-
    empty_trie(T),
    list_to_trie2(L, T, Trie).
list_to_trie2([], Trie, Trie).
list_to_trie2([K-V|R], Trie, Res) :-
    insert(Trie, K, V, TmpTrie),
    list_to_trie2(R, TmpTrie, Res).

to_kv_tuple(X, X-X).
gen_kv_tuples_of_range(N, KVTuples) :-
    my_numlist(1, N, L),
    maplist(to_kv_tuple, L, KVTuples).

my_numlist(From, To, L) :-
    my_numlist2(To, From, [], L).
my_numlist2(From, From, L, [From|L]) :- !.
my_numlist2(To, From, L, R) :-
    To1 is To-1,
    my_numlist2(To1, From, [To|L], R) .

:- begin_tests(insert_and_count).

test(insert_and_count_0) :-
    list_to_trie([], Trie),
    count(Trie, N), !,
    N == 0.

test(insert_and_count_100) :-
    gen_kv_tuples_of_range(100, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N), !,
    N == 100.

test(insert_and_count_1000) :-
    gen_kv_tuples_of_range(1000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N), !,
    N == 1000.

test(insert_and_count_10000) :-
    gen_kv_tuples_of_range(10000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N),
    !,
    N == 10000.

test(insert_and_count_5000) :-
    gen_kv_tuples_of_range(5000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N), !,
    N == 5000.

test(insert_and_count_7500) :-
    gen_kv_tuples_of_range(7500, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N), !,
    N == 7500.

test(insert_and_count_9000) :-
    gen_kv_tuples_of_range(9000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N), !,
    N == 9000.

test(insert_and_count_100000) :-
    gen_kv_tuples_of_range(100000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N),
    !,
    N == 100000.

test(insert_and_count_1000000) :-
    gen_kv_tuples_of_range(1000000, KVTuples),
    list_to_trie(KVTuples, Trie),
    count(Trie, N),
    !,
    N == 1000000.
:- end_tests(insert_and_count).


lookup(Trie, Key, Value) :-
    term_hash(Key, Hash),
    lookup_with_hash(0, Hash, Key, Trie, Value).
lookup_with_hash(Level, Hash, Key, Trie, Value) :-
    calc_pos(Hash, Level, Pos),
    get_pos(Pos, Trie, ValAtPos),
    lookup_with_val_at_pos(ValAtPos, Level, Hash, Key, Value).
lookup_with_val_at_pos(nil, _Level, _Hash, _Key, _) :- !, fail.
lookup_with_val_at_pos(v(Key, Value), _Level, _Hash, Key, Value) :- !.
lookup_with_val_at_pos(collision(L), _Level, _Hash, Key, Value) :-
    member(v(Key, Value), L), !.
lookup_with_val_at_pos(Node, Level, Hash, Key, Value) :-
    Level1 is Level + 1,
    lookup_with_hash(Level1, Hash, Key, Node, Value).


:- begin_tests(lookup).

test(lookup_some_vals) :-
    gen_kv_tuples_of_range(10000, KVTuples),
    list_to_trie(KVTuples, Trie),
    lookup(Trie, 100, V100), !, V100 == 100,
    lookup(Trie, 1000, V1000), !, V1000 == 1000,
    %% term_hash collides on [v(939,939),v(8621,8621)]
    lookup(Trie, 939, V939), !, V939 == 939,
    lookup(Trie, 8621, V8621), !, V8621 == 8621,
    \+ lookup(Trie, 20000, _).
:- end_tests(lookup).
